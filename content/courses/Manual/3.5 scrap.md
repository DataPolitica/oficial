---
title: Web Scraping
linktitle: 3.6 Web scraping
toc: true
type: docs
date: "2020-08-05T00:00:00+01:00"
draft: false
menu:
  example:
    parent: 3. Consiguiendo y preparando la data
    weight: 4

# Prev/next pager order (if `docs_section_pager` enabled in `params.toml`)
weight: 3
---

## Introducción

Como sabemos, en el R Studio nosotros trabajamos sobre objetos. Pues bien, algunas veces nosotros podemos tener nuestros objetos (bases de datos, usualmente) de archivos que nos entregan directamente; sin embargo, otras veces la información se encuentra en diversas páginas web dentro del internet. 

![Image](/cursos/3-5-1.jpg)

El **Web Sraping** es una técnica para conseguir información de forma rápida y sistematizada por medio de algoritmos de búsquedas. Para el caso del R Studio, es necesario utilizar paquetes construidos específicamente para web scraping. En otras palabras, estos paquetes lo que hacen es entrar a una página web, extraen cierta información que le indiquemos y lo cargan a nuestra sesión de R Studio

## Algunos puntos a tener en cuenta

Para hacer Web Scraping es necesario tener algunas consideraciones previas si es que antes no hemos explorado el contenido de una página web. 

- De antemano sabemos que existen distintos tipos de páginas web, algunos parecen una hoja con letras (como si fuese una hoja de Word), pero muchas contienen ciertos elementos: videos, tablas, cuadros, imágenes, enlaces, entre otros. Entrar al mundo de cómo se construyen las páginas web es un objetivo que escapa a este apartado. Sin embargo, será necesario recordar que detrás de lo que vemos siempre existen un conjunto de códigos, denominado código fuente, que han servido para construir la página web. 

- Sabiendo el código de ciertos elementos, como es el caso de las tablas, nosotros podemos decirle al R Studio que nos **extraiga** cierta información a nuestro entorno de trabajo. 

- Para ello, necesitamos el paquete "htmltab" el cual sirve para poder extraer tablas de diversos tipos de páginas web construidas en lenguaje html. 

- Es necesario anotar que existen muchos paquetes diseñados para web scraping. Otro paquete conocido es el paquete Rvest, cuyo contenido también te recomiendo revisar en [este enlace](https://cran.r-project.org/web/packages/rvest/rvest.pdf).

## Paso 1: Identificar nuestra página web y la tabla que queremos descargar

Primero tenemos que identificar nuestra página. En este caso entraremos a la página web de [Wikipedia titulada *Departamentos del Perú por IDH*](https://es.wikipedia.org/wiki/Anexo:Departamentos_del_Per%C3%BA_por_IDH). 

En esta página web figura una tabla con los departamentos del Perú y los resultados que han obtenido en las distintas mediciones del Índice de Desarrollo Humano. 

![Image](/cursos/3-5-2.jpg)

Listo, tenemos ya identificada nuestra página web y el *objeto* que queremos extraer (tabla de resultados de IDH según departamento en el Perú)

## Paso 2: Inspeccionar la página web y encontrar el *código* de la tabla

Para ello tenemos que darle click derecho a nuestra tabla y seleccionar la opción **inspeccionar**.

![Image](/cursos/3-5-2-1.jpg)

Vamos a ver que nos sale una subventana en la parte derecha que tiene muchos códigos. Tranquilos, estos códigos son la **infraestructura** de la página web. Cada letra y objeto que vemos en la vista normal tiene un código detrás con el cual ha sido programado. Literalmente estamos viendo la Matrix. 

Pues bien, luego de poner click derecho sobre nuestra tabla vamos ubicando el cursos en las líneas superiores hasta que veamos que la tabla se sombree por completo.

![Image](/cursos/3-5-3.jpg)

Luego de eso, damos click derecho sobre ese código, seleccionamos *Copy* y *Copy Xpath*.

![Image](/cursos/3-5-4.jpg)

El *Xpath* es como si fuese una ubicación del objeto que queremos extraer dentro de toda la infraestructura html de la página web.

Vemos que en este caso lo que copiamos es lo siguiente: 

![Image](/cursos/3-5-5.jpg)

## Paso 3: Utilizar el paquete *htmltab*

Una vez identificado la dirección de la página web y el *Xpath* del elemento que queremos descargar, ya podemos utilizar el paquete *htmltab*. Abrimos el paquete:

    library(htmltab)

Creamos dos objetos. Primero un objeto que sea el link de la página web y otro objeto que sea el código Xpath.

    link_de_pagina= "https://es.wikipedia.org/wiki/Anexo:Departamentos_del_Per%C3%BA_por_IDH"
    codigoXPATH ='//*[@id="mw-content-text"]/div[1]/center/table'

{{% alert note %}}
Cuidado: Si observas bien, en un caso hemos usado las "" y en otro ''. Debes recordar que en el caso del Xpath vamos a utilizar las comillas simples. Estas se pueden incluir presionando ALT + 39.
{{% /alert %}}

Luego, aplicamos la función htmltab en la cual le indicamos, en primer lugar, la dirección de la página (doc = link_de_página) y la ubicación del objeto que queremos extraer (which =codigoXPATH). A la base de datos extraída le daremos el nombre de data_IDH

    data_IDH = htmltab(doc = link_de_pagina, which =codigoXPATH)

Para finalizar vemos que en la parte superior derecha de nuestro entorno de trabajo ya figura un objeto que es nuestra base de datos extraída. Para corroborar los elementos (variables) de nuestra base de datos utilizamos la función names:

    names(data_IDH)

    ##  [1] "#"                                    
    ##  [2] "Departamento"                         
    ##  [3] "CÃ³digoÂ ISO"                         
    ##  [4] "CÃ³digo Ubigeo"                       
    ##  [5] "Capital"                              
    ##  [6] "Ã\215ndice de desarrollo humano 1993"    
    ##  [7] "Ã\215ndice de desarrollo hbr/>2000"      
    ##  [8] "Ã\215ndice de desarrollo humano 2003"    
    ##  [9] "Ã\215ndice de desarrollo humano 2005"    
    ## [10] "Ã\215ndice de desarrollo humano 2007"    
    ## [11] "Ã\215ndice de desarrollo humano 2012 â\200‹"
    ## [12] "Ã\215ndice de desarrollo humano 2019 â\200‹"

También le podemos aplicar el comando str() para ver la estructura de nuestro data.frame:

    str(data_IDH)

    ## 'data.frame':    24 obs. of  12 variables:
    ##  $ #                                    : chr  "1" "2" "3" "4" ...
    ##  $ Departamento                         : chr  "Lima" "Moquegua" "Arequipa" "Madre de Dios" ...
    ##  $ CÃ³digoÂ ISO                         : chr  "PE-LIM" "PE-MOQ" "PE-ARE" "PE-MDD" ...
    ##  $ CÃ³digo Ubigeo                       : chr  "15" "18" "04" "17" ...
    ##  $ Capital                              : chr  "Lima" "Moquegua" "Arequipa" "Puerto Maldonado" ...
    ##  $ Ãndice de desarrollo humano 1993    : chr  "0,6827" "0,6208" "0,6503" "0,5956" ...
    ##  $ Ãndice de desarrollo hbr/>2000      : chr  "0,7440" "0,6661" "0,6352" "0,6206" ...
    ##  $ Ãndice de desarrollo humano 2003    : chr  "0,7189" "0,6499" "0,6526" "0,6010" ...
    ##  $ Ãndice de desarrollo humano 2005    : chr  "0,7039" "0,6435" "0,6463" "0,5997" ...
    ##  $ Ãndice de desarrollo humano 2007    : chr  "0,6788" "0,6532" "0,6479" "0,6304" ...
    ##  $ Ãndice de desarrollo humano 2012 â€‹: chr  "0,6340" "0,6215" "0,5781" "0,5582" ...
    ##  $ Ãndice de desarrollo humano 2019 â€‹: chr  "0,7073" "0,6589" "0,6425" "0,6136" ...

Ya tenemos nuestra data de IDH como un objeto en nuestro R Studio. 